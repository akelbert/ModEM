# Makefile suited for building the Test3D program
# Generated using: ./fmkmf.pl [OPTIONS] Test3D.f90 > Makefile
# with command line options
# -p INV:LAPACK:SENS:UTILS:3D_MT:3D_MT/FWD:3D_MT/FWD/Mod2d:3D_MT/EMfield:3D_MT/ioMod
# -f90 g95 (compiler)
# -opt -g -ftrace=frame -fbounds-check (compiler optimisation)
# -l -lblas -llapack (linking options)

#  Uncomment these lines to make program with g95
# F90 = g95
# FFLAGS = -g -O2
# FFLAGS = -g -ftrace=frame -fbounds-check
# LIBS = -lblas -llapack
#  Uncomment these lines to make program for solaris
# F90 = f90
# FFLAGS = -dalign -g -C -w  -L/usr/local/lib
# LIBS = -xlic_lib=sunperf

# ------------------Macro-Defs---------------------
include Makefile.local
F90 = ifort
FFLAGS = -g -C
LIBS = -lblas -llapack

# -------------------End-macro-Defs---------------------------
OBJ = math_constants.o Grid3D.o utilities.o sg_scalar.o sg_vector.o sg_sparse_vector.o ModelParameter.o DataSpace.o sg_boundary.o SolnRHS.o sg_diff_oper.o WSfwd2Dpar.o WSutils.o WSfwd1Dmod.o WSfwd2Dmod.o FwdTEmod.o boundary_ws.o modelOperator3D.o solver.o EMsolve3D.o DataGridInfo.o InterpEB.o DataFunc.o EMsolver.o ioAscii.o MeasComb.o SensPDEcoeff.o SensMatrix.o NLCG.o Test3D.o 


all: Test3D 

# Here is the link step 
Test3D: $(OBJ) 
	 $(F90) -o $(OUTDIR)/Test3D $(OBJ) $(LIBS) 

# Here are the compile steps
 
math_constants.o:UTILS/math_constants.f90  
	 $(F90) -c $(FFLAGS) UTILS/math_constants.f90 

Grid3D.o:3D_MT/Grid3D.f90 math_constants.o 
	 $(F90) -c $(FFLAGS) 3D_MT/Grid3D.f90 

utilities.o:UTILS/utilities.f90 math_constants.o 
	 $(F90) -c $(FFLAGS) UTILS/utilities.f90 

sg_scalar.o:3D_MT/EMfield/sg_scalar.f90 math_constants.o Grid3D.o 
	 $(F90) -c $(FFLAGS) 3D_MT/EMfield/sg_scalar.f90 

sg_vector.o:3D_MT/EMfield/sg_vector.f90 math_constants.o Grid3D.o 
	 $(F90) -c $(FFLAGS) 3D_MT/EMfield/sg_vector.f90 

sg_sparse_vector.o:3D_MT/EMfield/sg_sparse_vector.f90 math_constants.o Grid3D.o sg_vector.o 
	 $(F90) -c $(FFLAGS) 3D_MT/EMfield/sg_sparse_vector.f90 

ModelParameter.o:3D_MT/ModelParameter.f90 Grid3D.o math_constants.o utilities.o sg_scalar.o sg_vector.o sg_sparse_vector.o 
	 $(F90) -c $(FFLAGS) 3D_MT/ModelParameter.f90 

DataSpace.o:SENS/DataSpace.f90 utilities.o math_constants.o 
	 $(F90) -c $(FFLAGS) SENS/DataSpace.f90 

sg_boundary.o:3D_MT/EMfield/sg_boundary.f90 math_constants.o Grid3D.o sg_vector.o 
	 $(F90) -c $(FFLAGS) 3D_MT/EMfield/sg_boundary.f90 

SolnRHS.o:3D_MT/SolnRHS.f90 math_constants.o utilities.o ModelParameter.o sg_vector.o sg_boundary.o sg_sparse_vector.o 
	 $(F90) -c $(FFLAGS) 3D_MT/SolnRHS.f90 

sg_diff_oper.o:3D_MT/EMfield/sg_diff_oper.f90 math_constants.o sg_vector.o sg_scalar.o 
	 $(F90) -c $(FFLAGS) 3D_MT/EMfield/sg_diff_oper.f90 

WSfwd2Dpar.o:3D_MT/FWD/Mod2d/WSfwd2Dpar.f90 math_constants.o 
	 $(F90) -c $(FFLAGS) 3D_MT/FWD/Mod2d/WSfwd2Dpar.f90 

WSutils.o:3D_MT/FWD/Mod2d/WSutils.f90 math_constants.o 
	 $(F90) -c $(FFLAGS) 3D_MT/FWD/Mod2d/WSutils.f90 

WSfwd1Dmod.o:3D_MT/FWD/Mod2d/WSfwd1Dmod.f90 WSfwd2Dpar.o WSutils.o 
	 $(F90) -c $(FFLAGS) 3D_MT/FWD/Mod2d/WSfwd1Dmod.f90 

WSfwd2Dmod.o:3D_MT/FWD/Mod2d/WSfwd2Dmod.f90 WSfwd1Dmod.o 
	 $(F90) -c $(FFLAGS) 3D_MT/FWD/Mod2d/WSfwd2Dmod.f90 

FwdTEmod.o:3D_MT/FWD/Mod2d/FwdTEmod.f90 WSfwd2Dmod.o 
	 $(F90) -c $(FFLAGS) 3D_MT/FWD/Mod2d/FwdTEmod.f90 

boundary_ws.o:3D_MT/FWD/boundary_ws.f90 sg_vector.o sg_scalar.o sg_boundary.o FwdTEmod.o 
	 $(F90) -c $(FFLAGS) 3D_MT/FWD/boundary_ws.f90 

modelOperator3D.o:3D_MT/FWD/modelOperator3D.f90 math_constants.o utilities.o Grid3D.o sg_vector.o sg_boundary.o ModelParameter.o boundary_ws.o 
	 $(F90) -c $(FFLAGS) 3D_MT/FWD/modelOperator3D.f90 

solver.o:3D_MT/FWD/solver.f90 math_constants.o sg_scalar.o modelOperator3D.o sg_vector.o modelOperator3D.o 
	 $(F90) -c $(FFLAGS) 3D_MT/FWD/solver.f90 

EMsolve3D.o:3D_MT/FWD/EMsolve3D.f90 sg_boundary.o sg_diff_oper.o sg_sparse_vector.o modelOperator3D.o solver.o SolnRHS.o sg_vector.o sg_scalar.o 
	 $(F90) -c $(FFLAGS) 3D_MT/FWD/EMsolve3D.f90 

DataGridInfo.o:3D_MT/DataGridInfo.f90 math_constants.o Grid3D.o 
	 $(F90) -c $(FFLAGS) 3D_MT/DataGridInfo.f90 

InterpEB.o:3D_MT/InterpEB.f90 utilities.o sg_sparse_vector.o ModelParameter.o 
	 $(F90) -c $(FFLAGS) 3D_MT/InterpEB.f90 

DataFunc.o:3D_MT/DataFunc.f90 InterpEB.o SolnRHS.o math_constants.o DataGridInfo.o 
	 $(F90) -c $(FFLAGS) 3D_MT/DataFunc.f90 

EMsolver.o:3D_MT/EMsolver.f90 math_constants.o DataFunc.o DataSpace.o EMsolve3D.o 
	 $(F90) -c $(FFLAGS) 3D_MT/EMsolver.f90 

ioAscii.o:3D_MT/ioMod/ioAscii.f90 Grid3D.o math_constants.o EMsolve3D.o DataSpace.o DataGridInfo.o EMsolver.o 
	 $(F90) -c $(FFLAGS) 3D_MT/ioMod/ioAscii.f90 

MeasComb.o:SENS/MeasComb.f90 math_constants.o utilities.o DataSpace.o ModelParameter.o SolnRHS.o DataFunc.o 
	 $(F90) -c $(FFLAGS) SENS/MeasComb.f90 

SensPDEcoeff.o:3D_MT/SensPDEcoeff.f90 math_constants.o utilities.o ModelParameter.o DataFunc.o sg_vector.o 
	 $(F90) -c $(FFLAGS) 3D_MT/SensPDEcoeff.f90 

SensMatrix.o:SENS/SensMatrix.f90 math_constants.o utilities.o MeasComb.o SensPDEcoeff.o EMsolver.o 
	 $(F90) -c $(FFLAGS) SENS/SensMatrix.f90 

NLCG.o:INV/NLCG.f90 SensMatrix.o 
	 $(F90) -c $(FFLAGS) INV/NLCG.f90 

Test3D.o:Test3D.f90 ModelParameter.o DataSpace.o SolnRHS.o ioAscii.o DataFunc.o SensMatrix.o NLCG.o 
	 $(F90) -c $(FFLAGS) Test3D.f90 

# Type " make clean " to get rid of all object and module files 
clean: 
	rm -f *~ *.o *.obj *.mod *.d *.s00 *.dbg *.stackdump \
	`find . -mindepth 1 -name "*~"` 

cleanall: clean 
	rm -f $(OUTDIR)/Test3D 

src: clean 
	tar cvfz $(ARCHIVE).tgz * 

  
