# Makefile suited for building the Mod3DMT program
# Generated using: ./fmkmf.pl [OPTIONS] Mod3DMT.f90 > Makefile
# with command line options
# -p .:INV:LAPACK:SENS:UTILS:3D_MT:3D_MT/modelParam:3D_MT/FWD:3D_MT/FWD/Mod2d:3D_MT/EMfield:3D_MT/ioMod
# -f90 g95 (compiler)
# -opt -g -C (compiler optimisation)
# -l -lblas -llapack (linking options)

#  Uncomment these lines to make program with g95
# F90 = g95
# FFLAGS = -g -O2
# FFLAGS = -g -ftrace=frame -fbounds-check
# LIBS = -lblas -llapack
#  Uncomment these lines to make program for solaris
# F90 = f90
# FFLAGS = -dalign -g -C -w  -L/usr/local/lib
# LIBS = -xlic_lib=sunperf

# ------------------Macro-Defs---------------------
include Makefile.local
F90 = ifort
FFLAGS = -O3
LIBS = -lblas -llapack

# -------------------End-macro-Defs---------------------------
OBJ = math_constants.o utilities.o DataSpace.o Grid3D.o sg_scalar.o sg_vector.o sg_sparse_vector.o ModelParameter.o sg_boundary.o SolnRHS.o InterpEB.o DataFunc.o MeasComb.o SensPDEcoeff.o sg_diff_oper.o WSfwd2Dpar.o WSutils.o WSfwd1Dmod.o WSfwd2Dmod.o FwdTEmod.o boundary_ws.o modelOperator3D.o solver.o EMsolve3D.o EMsolver.o SensMatrix.o UserCtrl.o ioAscii.o Main.o NLCG.o Mod3DMT.o 


all: Mod3DMT 

# Here is the link step 
Mod3DMT: $(OBJ) 
	 $(F90) -o $(OUTDIR)/Mod3DMT $(OBJ) $(LIBS) 

# Here are the compile steps
 
math_constants.o:UTILS/math_constants.f90  
	 $(F90) -c $(FFLAGS) UTILS/math_constants.f90 

utilities.o:UTILS/utilities.f90 math_constants.o 
	 $(F90) -c $(FFLAGS) UTILS/utilities.f90 

DataSpace.o:SENS/DataSpace.f90 utilities.o math_constants.o 
	 $(F90) -c $(FFLAGS) SENS/DataSpace.f90 

Grid3D.o:3D_MT/Grid3D.f90 math_constants.o 
	 $(F90) -c $(FFLAGS) 3D_MT/Grid3D.f90 

sg_scalar.o:3D_MT/EMfield/sg_scalar.f90 math_constants.o Grid3D.o 
	 $(F90) -c $(FFLAGS) 3D_MT/EMfield/sg_scalar.f90 

sg_vector.o:3D_MT/EMfield/sg_vector.f90 math_constants.o Grid3D.o 
	 $(F90) -c $(FFLAGS) 3D_MT/EMfield/sg_vector.f90 

sg_sparse_vector.o:3D_MT/EMfield/sg_sparse_vector.f90 math_constants.o Grid3D.o sg_vector.o 
	 $(F90) -c $(FFLAGS) 3D_MT/EMfield/sg_sparse_vector.f90 

ModelParameter.o:3D_MT/modelParam/ModelParameter.f90 Grid3D.o math_constants.o utilities.o sg_scalar.o sg_vector.o sg_sparse_vector.o 
	 $(F90) -c $(FFLAGS) 3D_MT/modelParam/ModelParameter.f90 

sg_boundary.o:3D_MT/EMfield/sg_boundary.f90 math_constants.o Grid3D.o sg_vector.o 
	 $(F90) -c $(FFLAGS) 3D_MT/EMfield/sg_boundary.f90 

SolnRHS.o:3D_MT/SolnRHS.f90 math_constants.o utilities.o ModelParameter.o sg_vector.o sg_boundary.o sg_sparse_vector.o 
	 $(F90) -c $(FFLAGS) 3D_MT/SolnRHS.f90 

InterpEB.o:3D_MT/InterpEB.f90 utilities.o sg_sparse_vector.o ModelParameter.o 
	 $(F90) -c $(FFLAGS) 3D_MT/InterpEB.f90 

DataFunc.o:3D_MT/DataFunc.f90 InterpEB.o SolnRHS.o math_constants.o 
	 $(F90) -c $(FFLAGS) 3D_MT/DataFunc.f90 

MeasComb.o:SENS/MeasComb.f90 math_constants.o utilities.o DataSpace.o ModelParameter.o SolnRHS.o DataFunc.o 
	 $(F90) -c $(FFLAGS) SENS/MeasComb.f90 

SensPDEcoeff.o:3D_MT/SensPDEcoeff.f90 math_constants.o utilities.o ModelParameter.o DataFunc.o sg_vector.o 
	 $(F90) -c $(FFLAGS) 3D_MT/SensPDEcoeff.f90 

sg_diff_oper.o:3D_MT/EMfield/sg_diff_oper.f90 math_constants.o sg_vector.o sg_scalar.o 
	 $(F90) -c $(FFLAGS) 3D_MT/EMfield/sg_diff_oper.f90 

WSfwd2Dpar.o:3D_MT/FWD/Mod2d/WSfwd2Dpar.f90 math_constants.o 
	 $(F90) -c $(FFLAGS) 3D_MT/FWD/Mod2d/WSfwd2Dpar.f90 

WSutils.o:3D_MT/FWD/Mod2d/WSutils.f90 math_constants.o 
	 $(F90) -c $(FFLAGS) 3D_MT/FWD/Mod2d/WSutils.f90 

WSfwd1Dmod.o:3D_MT/FWD/Mod2d/WSfwd1Dmod.f90 WSfwd2Dpar.o WSutils.o 
	 $(F90) -c $(FFLAGS) 3D_MT/FWD/Mod2d/WSfwd1Dmod.f90 

WSfwd2Dmod.o:3D_MT/FWD/Mod2d/WSfwd2Dmod.f90 WSfwd1Dmod.o 
	 $(F90) -c $(FFLAGS) 3D_MT/FWD/Mod2d/WSfwd2Dmod.f90 

FwdTEmod.o:3D_MT/FWD/Mod2d/FwdTEmod.f90 WSfwd2Dmod.o 
	 $(F90) -c $(FFLAGS) 3D_MT/FWD/Mod2d/FwdTEmod.f90 

boundary_ws.o:3D_MT/FWD/boundary_ws.f90 sg_vector.o sg_scalar.o sg_boundary.o FwdTEmod.o 
	 $(F90) -c $(FFLAGS) 3D_MT/FWD/boundary_ws.f90 

modelOperator3D.o:3D_MT/FWD/modelOperator3D.f90 math_constants.o utilities.o Grid3D.o sg_vector.o sg_boundary.o ModelParameter.o boundary_ws.o 
	 $(F90) -c $(FFLAGS) 3D_MT/FWD/modelOperator3D.f90 

solver.o:3D_MT/FWD/solver.f90 math_constants.o sg_scalar.o modelOperator3D.o sg_vector.o modelOperator3D.o 
	 $(F90) -c $(FFLAGS) 3D_MT/FWD/solver.f90 

EMsolve3D.o:3D_MT/FWD/EMsolve3D.f90 sg_boundary.o sg_diff_oper.o sg_sparse_vector.o modelOperator3D.o solver.o SolnRHS.o sg_vector.o sg_scalar.o 
	 $(F90) -c $(FFLAGS) 3D_MT/FWD/EMsolve3D.f90 

EMsolver.o:3D_MT/EMsolver.f90 math_constants.o DataFunc.o DataSpace.o EMsolve3D.o 
	 $(F90) -c $(FFLAGS) 3D_MT/EMsolver.f90 

SensMatrix.o:SENS/SensMatrix.f90 math_constants.o utilities.o MeasComb.o SensPDEcoeff.o EMsolver.o 
	 $(F90) -c $(FFLAGS) SENS/SensMatrix.f90 

UserCtrl.o:./UserCtrl.f90  
	 $(F90) -c $(FFLAGS) ./UserCtrl.f90 

ioAscii.o:3D_MT/ioMod/ioAscii.f90 Grid3D.o math_constants.o EMsolve3D.o DataSpace.o DataFunc.o EMsolver.o 
	 $(F90) -c $(FFLAGS) 3D_MT/ioMod/ioAscii.f90 

Main.o:3D_MT/Main.f90 ModelParameter.o DataSpace.o DataFunc.o EMsolver.o UserCtrl.o ioAscii.o 
	 $(F90) -c $(FFLAGS) 3D_MT/Main.f90 

NLCG.o:INV/NLCG.f90 SensMatrix.o 
	 $(F90) -c $(FFLAGS) INV/NLCG.f90 

Mod3DMT.o:Mod3DMT.f90 SensMatrix.o Main.o NLCG.o 
	 $(F90) -c $(FFLAGS) Mod3DMT.f90 

# Type " make clean " to get rid of all object and module files 
clean: 
	rm -f *~ *.o *.obj *.mod *.d *.s00 *.dbg *.stackdump \
	`find . -mindepth 1 -name "*~"` 

cleanall: clean 
	rm -f $(OUTDIR)/Mod3DMT 

src: clean 
	tar cvfz $(ARCHIVE).tgz * 

  
